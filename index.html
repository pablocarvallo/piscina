<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- Meta tag crucial para que funcione como una aplicaci贸n fullscreen en iOS (sin barra de direcciones) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registro de Mantenciones de Piscina</title>
    
    <!-- Configuraci贸n del Icono para iOS (Asumiendo que el archivo se llama 'apple-touch-icon.png' y est谩 en la misma carpeta) -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="192x192" href="apple-touch-icon.png">

    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci贸n de la fuente Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f0f9ff; /* Azul muy claro para fondo de piscina */
        }
        /* Estilos personalizados para el campo de fecha y botones */
        .input-date {
            appearance: none;
            cursor: pointer;
            text-align: center;
        }
        /* Clase para el mensaje de notificaci贸n personalizado */
        .notification-bar {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="p-4 sm:p-6">

    <!-- Encabezado de la Aplicaci贸n -->
    <header class="text-center mb-8">
        <h1 class="text-3xl font-extrabold text-blue-800 tracking-tight">
            Mantenci贸n de la piscina
        </h1>
        <p class="text-sm text-blue-600 mt-1">
            Tu app simple para la piscina
        </p>
    </header>

    <!-- Notificaci贸n (Personalizada, reemplaza alert()) -->
    <div id="notification" class="notification-bar fixed top-0 left-0 right-0 p-3 text-center text-white font-semibold bg-green-500 opacity-0 -translate-y-full shadow-lg z-50 rounded-b-lg mx-auto w-11/12 max-w-sm" style="transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);">
        Mensaje de estado.
    </div>
    
    <!-- Contenedor Principal (Input y Botones) -->
    <main class="max-w-md mx-auto w-full bg-white p-6 rounded-2xl shadow-xl">
        
        <p class="text-sm text-gray-500 mb-4 text-center">
            Selecciona la fecha de la 煤ltima mantenci贸n.
        </p>
        
        <!-- Campo de Entrada de Fecha -->
        <div class="flex flex-col space-y-4">
            <input type="date" id="maintenance-date" 
                   class="input-date w-full p-3 border-2 border-blue-300 rounded-xl text-lg font-medium text-blue-900 focus:border-blue-500 focus:ring-blue-500 focus:outline-none transition duration-150 ease-in-out"
                   max=""> <!-- M谩x se setea en JS a la fecha actual -->
            
            <!-- Bot贸n de Registro -->
            <button id="add-date-btn" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform active:scale-95 transition duration-150 ease-in-out">
                Registrar Mantenci贸n
            </button>
        </div>

    </main>
    
    <!-- Secci贸n de Historial de Mantenciones -->
    <section class="mt-8 max-w-md mx-auto w-full flex-grow">
        <h2 class="text-xl font-semibold text-blue-800 mb-4 text-center">
            Historial de Fechas
        </h2>

        <!-- Indicador de Carga/Estado -->
        <div id="loading-state" class="text-center text-gray-500 py-4">Cargando datos...</div>
        
        <!-- Lista de Fechas (se llena con JS) -->
        <ul id="dates-list" class="bg-white rounded-2xl shadow-xl divide-y divide-blue-100 overflow-hidden">
            <!-- Las fechas se insertar谩n aqu铆 -->
        </ul>
        
        <!-- Mensaje si no hay registros -->
        <p id="no-records-message" class="text-center text-gray-500 mt-4 p-4 bg-white rounded-xl shadow-md hidden">
            A煤n no hay registros de mantenci贸n. 隆Comienza a registrar!
        </p>

    </section>
    
    <!-- Secci贸n de Opciones (Resetear) -->
    <footer class="mt-8 mb-4 max-w-md mx-auto w-full">
        <!-- Bot贸n de Reset -->
        <button id="reset-btn" 
                class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-xl shadow-md opacity-50 hover:opacity-100 transition duration-150 ease-in-out text-sm">
             Resetear Todos los Registros
        </button>
        <!-- Modal de Confirmaci贸n para Reset -->
        <div id="reset-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
                <h3 class="text-xl font-bold text-red-600 mb-4">Confirmar Reseteo</h3>
                <p class="text-gray-700 mb-6">驴Est谩s absolutamente seguro de que quieres borrar **TODOS** los registros de mantenci贸n? Esta acci贸n es irreversible y solo afecta a este dispositivo.</p>
                <div class="flex justify-end space-x-3">
                    <button id="cancel-reset-btn" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300">Cancelar</button>
                    <button id="confirm-reset-btn" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 shadow-md">S铆, Borrar Todo</button>
                </div>
            </div>
        </div>
    </footer>


    <!-- Scripts de L贸gica LocalStorage -->
    <script type="module">
        
        // --- Elementos del DOM ---
        const dateInput = document.getElementById('maintenance-date');
        const addDateBtn = document.getElementById('add-date-btn');
        const datesList = document.getElementById('dates-list');
        const resetBtn = document.getElementById('reset-btn');
        const resetModal = document.getElementById('reset-modal');
        const confirmResetBtn = document.getElementById('confirm-reset-btn');
        const cancelResetBtn = document.getElementById('cancel-reset-btn');
        const loadingState = document.getElementById('loading-state');
        const noRecordsMessage = document.getElementById('no-records-message');
        const notificationBar = document.getElementById('notification');
        
        // Establecer la fecha m谩xima del input a hoy
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('max', today);
        dateInput.value = today; // Valor por defecto

        // --- Funciones de Utilidad ---

        /** Muestra una notificaci贸n temporal. */
        const showNotification = (message, isError = false) => {
            // Contexto "Local" es el predeterminado ahora
            notificationBar.textContent = `${message}`; 
            
            notificationBar.className = `notification-bar fixed top-0 left-0 right-0 p-3 text-center text-white font-semibold shadow-lg z-50 rounded-b-lg mx-auto w-11/12 max-w-sm ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            
            // Animaci贸n: Deslizar hacia abajo
            notificationBar.classList.remove('-translate-y-full');
            notificationBar.classList.add('translate-y-0', 'opacity-100');

            setTimeout(() => {
                // Animaci贸n: Deslizar hacia arriba
                notificationBar.classList.remove('translate-y-0', 'opacity-100');
                notificationBar.classList.add('-translate-y-full', 'opacity-0');
            }, 3000);
        };
        
        /** Formatea una fecha ISO (YYYY-MM-DD) a un formato legible (DD/MM/YYYY). */
        const formatDateForDisplay = (isoDate) => {
            if (!isoDate) return 'Fecha Inv谩lida';
            const parts = isoDate.split('-');
            if (parts.length === 3) {
                return `${parts[2]}/${parts[1]}/${parts[0]}`;
            }
            return isoDate;
        };
        
        // --- L贸gica de LocalStorage (Almacenamiento Local) ---

        /** Carga las fechas desde localStorage. */
        const loadDatesLocal = () => {
            const data = localStorage.getItem('pool_maintenance_dates');
            try {
                const dates = data ? JSON.parse(data) : [];
                // Ordenar localmente de m谩s reciente a m谩s antigua (descendente)
                dates.sort((a, b) => b.date.localeCompare(a.date));
                return dates;
            } catch (e) {
                console.error("Error parsing localStorage data:", e);
                return [];
            }
        };

        /** Renderiza la lista de fechas en el DOM. */
        const renderDates = (dates) => {
            datesList.innerHTML = '';
            
            if (dates.length === 0) {
                noRecordsMessage.classList.remove('hidden');
                loadingState.classList.add('hidden');
                return;
            }
            
            noRecordsMessage.classList.add('hidden');
            loadingState.classList.add('hidden');

            dates.forEach(({ date, id }, index) => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center p-4 hover:bg-blue-50 transition duration-100';
                
                const formattedDate = formatDateForDisplay(date);
                
                // Determinar si es la fecha m谩s reciente (el primer elemento despu茅s de ordenar)
                const isLatest = (index === 0);
                
                li.innerHTML = `
                    <span class="text-gray-700 text-lg flex items-center">
                        ${isLatest ? '<span class="text-xs font-bold text-green-600 bg-green-100 px-2 py-0.5 rounded-full mr-2">LTIMA</span>' : ''}
                        ${formattedDate}
                    </span>
                    <button data-id="${id}" class="delete-btn text-red-400 hover:text-red-600 p-2 rounded-full hover:bg-red-50 transition duration-150" aria-label="Eliminar registro">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
                datesList.appendChild(li);
            });
            
            // Agregar listeners para los botones de eliminar despu茅s de renderizar
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', handleDeleteDate);
            });
        };

        /** Guarda un nuevo registro en localStorage. */
        const saveDate = (date) => {
            if (!date) {
                showNotification("Por favor, selecciona una fecha v谩lida.", true);
                return;
            }
            
            const dates = loadDatesLocal();
            const newRecord = { 
                // Generar un ID 煤nico para permitir la eliminaci贸n
                id: Math.random().toString(36).substring(2, 9) + Date.now().toString(36), 
                date: date,
                timestamp: new Date().getTime()
            };
            dates.push(newRecord); 
            localStorage.setItem('pool_maintenance_dates', JSON.stringify(dates));
            
            // Recargar y renderizar la lista despu茅s de guardar (lo que incluye el ordenamiento)
            renderDates(loadDatesLocal()); 
            showNotification("隆Registro de mantenci贸n guardado localmente!");
        };

        /** Elimina un registro de localStorage. */
        const deleteDate = (id) => {
            let dates = loadDatesLocal();
            dates = dates.filter(record => record.id !== id);
            localStorage.setItem('pool_maintenance_dates', JSON.stringify(dates));
            renderDates(dates); // Rerenderizar inmediatamente
            showNotification("Registro eliminado localmente.");
        };

        /** Borra todos los registros de localStorage. */
        const resetAllDates = () => {
            resetModal.classList.add('hidden');
            localStorage.removeItem('pool_maintenance_dates');
            renderDates([]); // Rerenderizar con lista vac铆a
            showNotification("隆Todos los registros locales han sido borrados con 茅xito!");
        };

        // --- Handlers de Eventos ---
        
        const handleAddDate = () => {
            const selectedDate = dateInput.value;
            if (selectedDate) {
                saveDate(selectedDate);
            } else {
                showNotification("Debes seleccionar una fecha.", true);
            }
        };
        
        const handleDeleteDate = (event) => {
            const docId = event.currentTarget.dataset.id;
            if (docId) {
                deleteDate(docId);
            }
        };

        const handleResetClick = () => {
            // Mostrar el modal de confirmaci贸n
            resetModal.classList.remove('hidden');
        };

        const handleCancelReset = () => {
            // Ocultar el modal de confirmaci贸n
            resetModal.classList.add('hidden');
        };

        // --- Configuraci贸n Inicial ---

        const initializeApp = () => {
            loadingState.textContent = "Datos cargados desde el almacenamiento local.";
            
            // Cargar y mostrar los datos iniciales
            renderDates(loadDatesLocal());
            
            // Asignar listeners
            addDateBtn.addEventListener('click', handleAddDate);
            resetBtn.addEventListener('click', handleResetClick);
            cancelResetBtn.addEventListener('click', handleCancelReset);
            confirmResetBtn.addEventListener('click', resetAllDates);
        };

        // Iniciar la aplicaci贸n
        initializeApp();

    </script>
</body>
</html>
